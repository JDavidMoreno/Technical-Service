<?xml version="1.0" encoding="utf-8" ?>

<odoo>
	<record id="res_users_inherited_view" model="ir.ui.view">
		<field name="name">res.users.inherited.view</field>
		<field name="model">res.users</field>
		<field name="inherit_id" ref="base.view_users_form"/>
		<field name="arch" type="xml">
			<xpath expr="//notebook" position="inside">
				<page string="Other Applications">
					<group>
						<group>
							<field name="technical_team_id" />
						</group>
					</group>
				</page>
			</xpath>
		</field>
	</record>

	<record id="invoice_see_action" model="ir.actions.act_window">
		<field name="name">Invoice</field>
		<field name="res_model">account.invoice</field>
		<field name="view_type">form</field>
		<field name="view_mode">tree,form,calendar,graph</field>
		<field name="view_id" ref="account.invoice_form"/>
		<field name="search_view_id" ref="account.view_account_invoice_filter"/>
	</record>

	<record id="requests_kanban_view" model="ir.ui.view">
		<field name="name">requests.kaban.view</field>
		<field name="model">technical.service.request</field>
		<field name="inherit_id" ref="maintenance.hr_equipment_request_view_kanban"/>
		<field name="mode">primary</field>
		<field name="arch" type="xml">
			<xpath expr="//kanban" position="attributes">
				<attribute name="quick_create">false</attribute>
			</xpath>
			<xpath expr="//templates/t[@t-name='kanban-tooltip']" position="replace">
				<t t-name="kanban-tooltip">
					<p>Click here to see details</p>
				</t>
			</xpath>
			<field name="activity_state" position="after">
				<field name="related_company_id"/>
				<field name="technical_team"/>
				<field name="partner_id"/>
				<field name="address"/>
				<field name="device"/>
				<field name="custom_field1"/>
				<field name="custom_field2"/>
				<field name="close_date"/>
				<field name="requirements"/>
				<field name="invoice_id"/>
				<field name="stage_id"/>
				<field name="stage_sequence"/>
				<field name="first_schedule_date"/>
				<field name="new_schedule_date"/>
			</field>
			<xpath expr="//div[@class='o_kanban_record_top']/b" position="inside">
				<field name="related_company_id"/>
			</xpath>
			<xpath expr="//div[@class='o_kanban_record_body']/span[@class='oe_grey']" position="replace">
				<span class="oe_grey">
					<field name="equipment_id"/>
					<field name="technical_team"/>
					<br/>
				</span>
			</xpath>
			<xpath expr="//div[hasclass('o_kanban_record_bottom')]" position="after">
				<button type="object" name="check_requirements" class="btn-primary" attrs="{'invisible': [('requirements', '=', True)]}">Requirements</button>
				<button type="object" name="generate_invoice" class="btn-primary" attrs="{'invisible': ['|', ('stage_sequence', 'not in', (3,)), ('requirements', '=', False)]}">Generate Invoice</button>
			</xpath>
		</field>
	</record>

	<record id="requests_form_view" model="ir.ui.view">
		<field name="name">requests.form.view</field>
		<field name="model">technical.service.request</field>
		<field name="arch" type="xml">
			<form string="Maintenance Request">
			    <header>
			        <button string="Cancel" name="archive_equipment_request" type="object" attrs="{'invisible': [('archive', '=', True)]}"/>
			        <button string="Reopen Request" name="reset_equipment_request" type="object" attrs="{'invisible': [('archive', '=', False)]}"/>
			        <button string="Requirements" type="object" name="check_requirements" class="btn-primary" attrs="{'invisible': [('requirements', '=', True)]}" />
			        <button string="Generate Invoice" name="generate_invoice" type="object" attrs="{'invisible': ['|', ('stage_sequence', 'not in', (3,)), ('requirements', '=', False)]}" class="btn-primary" />
			        <field name="stage_id" widget="statusbar" options="{'clickable': '1'}" attrs="{'invisible': [('archive', '=', True)]}"/>
			    </header>
			    <sheet>
			    	<div class="oe_button_box" attrs="{'invisible': [('stage_sequence', 'not in', (5,))]}">
                        <button name="invoice_see" type="object" class="oe_stat_button" icon="fa-file-text">
                            <field name="invoice_id" widget="statinfo"/>
                        </button>
                    </div>
                    <field name="color" invisible="True"/>
			    	<field name="category_id" groups="maintenance.group_equipment_manager" invisible="1"/>
			    	<field name="requirements" invisible="1"/>
			    	<field name="stage_sequence" invisible="1"/>
			    	<div attrs="{'invisible': [('archive', '=', False)]}">
			    	    <span class="badge badge-warning float-right">Canceled</span>
			    	</div>
			    	<div class="oe_title">
			    	    <label for="name" class="oe_edit_only" string="Name"/>
			    	    <h1>
			    	        <field name="name" placeholder="Maintenance Request"/>
			    	    </h1>
			    	</div>
			    	<group>
			    		<group>
			    			<field name="owner_user_id" string="Requested By"/>
			    			<field name="request_date" readonly="True"/>
			    		</group>
			    		<group>
			    			<field name="priority" widget="priority"/>
			    			<field name="archive" invisible="1"/>
			    			<field name="kanban_state" class="oe_inline" widget="state_selection"/>
			    		</group>
			    	</group>
			    	<group>
			    		<group>
			    			<separator string="Customer"/>
			    			<field name="our_companies" invisible="1"/>
			    			<field name="partner_id" domain="[('id','not in',our_companies)]"/>
			    			<field name="address"/>
			    			<field name="device"/>
			    			<br/><br/>
			    			<separator string="Operation"/>
			    			<field name="user_id" string="Responsible"/>
			    			<field name="technical_team"/>
			    			<field name="first_schedule_date" string="Scheduled Date"  attrs="{'invisible': [('stage_sequence', 'not in', (0,1,))]}"/>
                            <field name="close_date" groups="base.group_no_one" readonly="True"/>
                        </group>
                        <group>
                        	<separator string="Data by Company"/>
                        	<field name="related_company_id"/>
                        	<field name="custom_field1" attrs="{'invisible': [('related_company_id','not in', (19,))]}"/>
                        	<field name="custom_field2"/>
                        </group>
                    </group>
                    <div class="technical_service" attrs="{'invisible': [('stage_sequence', 'not in', (2, 3, 4, 5))]}">
                		<label for="new_schedule_date" style="color: #7c7bad;" /><br/>
                		<field name="new_schedule_date" context="{'default_state': 'open', 'default_allday': False, 'default_name': name}">
                			<tree editable="bottom" class="technical_service_tree">
                				<field name="id" invisible="True"/>
                				<field name="name" invisible="True"/>
                				<field name="start_datetime" string="Start Visit"/>
                				<field name="start_date" invisible="True"/>
                				<field name="start" invisible="True"/>
                				<field name="stop_datetime" string="End"/>
                				<field name="stop_date" invisible="True"/>
                				<field name="stop" invisible="True"/>
                				<field name="allday" invisible="True"/>
                				<field name="state" invisible="True"/>
                				<field name="duration" widget="float_time"/>
                			</tree>
                		</field>
                		<br/>
                		<br/>
                		<br/>
                		<label for="invoice_line_ids"  style="color: #7c7bad;"/><br/>
                    	<field name="invoice_line_ids" context="{'default_invoice_id': invoice_id, 'default_account_id': 480, 'default_currency_id': 1, 'default_product_id': None}">
                    		<tree editable="bottom" class="technical_service_tree">
                    			<field name="technical_request" invisible="1"/>
                    			<field name="name" string="Items"/>
                    			<field name="account_id" invisible="1" />
                    			<field name="invoice_id" invisible="1"/>
                    			<field name="quantity"/>
                    			<field name="uom_id" groups="uom.group_uom"/>
                    			<field name="price_unit"/>
                    			<field name="invoice_line_tax_ids" context="{'tree_view_ref': 'account.account_tax_view_tree', 'search_view_ref': 'account.account_tax_view_search'}" domain="[('type_tax_use', '=', 'sale')]" widget="many2many_tags"/>
                    			<field name="price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                    			<field name="price_total" groups="account.group_show_line_subtotals_tax_included"/>
                    			<field name="currency_id" invisible="1"/>
                    		</tree>
                    	</field>
                    </div>
                    <field name='description' placeholder="Internal Note ......."/>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record id="request_tree_view" model="ir.ui.view">
    	<field name="name">request.tree.view</field>
    	<field name="model">technical.service.request</field>
    	<field name="arch" type="xml">
    		<tree>
    			<field name="name"/>
    			<field name="partner_id"/>
    			<field name="related_company_id"/>
    			<field name="technical_team"/>
    			<field name="new_schedule_date"/>
    			<field name="close_date"/>
    		</tree>
    	</field>
    </record>

    <record id="request_search_view" model="ir.ui.view">
    	<field name="name">request.search.view</field>
    	<field name="model">technical.service.request</field>
    	<field name="arch" type="xml">
    		<search>
	    		<field name="technical_team"/>
	    		<field name="company_id"/>
	    		<field name="name"/>
	    		<group string="Group by">
	    			<filter string="Company" name="request_groupby_company" domain="[]" context="{'group_by': 'company_id'}"/>
	    			<filter string="Team" name="request_groupby_team" groups="technical_service.group_technical_service_manager" domain="[]" context="{'group_by': 'technical_team'}"/>
	    		</group>
	    	</search>
    	</field>
    </record>

	<record id="requests_action" model="ir.actions.act_window">
		<field name="name">Technical Service Requests</field>
		<field name="res_model">technical.service.request</field>
	    <field name="view_mode">kanban,form</field>
	    <field name="view_id" ref="requests_kanban_view"/>
	    <field name="help" type="html">
	        <p class="o_view_nocontent_smiling_face">
	            Add a new technical service request
	        </p>
	    </field>
	</record>

	<record id="teams_form_view" model="ir.ui.view">
		<field name="name">teams.form.view</field>
		<field name="model">technical.service.team</field>
		<field name="arch" type="xml">
			<form>
				<sheet>
					<label for="name" string="Name"/><br/>
					<h1><field name="name"/></h1>
					<group>
						<group>
							<field name="rate"/>	
						</group>
						<group>
							<field name="color" invisible="True"/>
						</group>
					</group>
					<notebook>
						<page name="members" string="Team Members">
							<field name="member_ids" widget="many2many">
								<kanban quick_create="false" create="true" delete="true">
									<field name="id"/>
									<field name="name"/>
									<templates>
										<t t-name="kanban-box">
											<div class="oe_kanban_global_click" style="max-width: 200px">
												<div class="o_kanban_record_top">
													<img t-att-src="kanban_image('res.users', 'image_small', record.id.raw_value)" height="40" width="40" class="oe_avatar oe_kaban_avatar_smallbox mb0" alt="Avatar"/>
													<div class="o_kanban_record_headings ml8">
														<strong class="o_kanban_record_title"><field name="name"/></strong>
													</div>
												</div>
											</div>
										</t>
									</templates>
								</kanban>
							</field>
						</page>
						<page name="requests" string="Requests">
							<field name="request_ids"/>
						</page>
					</notebook>
				</sheet>
			</form>
		</field>
	</record>

	<record id="teams_action" model="ir.actions.act_window">
		<field name="name">Teams</field>
		<field name="res_model">technical.service.team</field>
		<field name="view_mode">tree,form</field>
	</record>

	<record id="devices_form_view" model="ir.ui.view">
		<field name="name">devices.form.view</field>
		<field name="model">technical.service.device</field>
		<field name="arch" type="xml">
			<form>
				<sheet>
					<field name="photo" widget='image' class="oe_avatar"/>
					<group>
						<group>
							<field name="name" />
							<field name="category_id"/>
						</group>
						<group>
							<field name="serial_code"/>
							<field name="company_id"/>
						</group>
					</group>
					<h3><label for="notes" string="Notes"/></h3>
					<field name="notes"/>
				</sheet>
			</form>
		</field>
	</record>

	<record id="devices_kanban_view" model="ir.ui.view">
		<field name="name">devices.kanban.view</field>
		<field name="model">technical.service.device</field>
		<field name="arch" type="xml">
			<kanban>
				<field name="id"/>
				<field name="image_medium"/>
				<field name="name"/>
				<field name="serial_code"/>
				<field name="company_id"/>
				<templates>
					<t t-name="kanban-box">
						<div t-attf-class="oe_kanban_card oe_kanban_global_click o_kanban_record_has_image_fill">
							<div class="o_kanban_image">
                               <img t-att-alt="record.name.value" t-att-src="kanban_image('technical.service.device', 'image_medium', record.id.raw_value)"/>
                           </div>
							<div class="o_dropdown_kanban dropdown">
								<a role="button" class="dropdown-toggle o-no-caret btn" data-toggle="dropdown" href="#" aria-label="Dropdown menu" title="Dropdown menu">
									<span class="fa fa-ellipsis-v"/>
								</a>
								<div class="dropdown-menu" role="menu">
									<t t-if="widget.editable"><a role="menuitem" type="edit" class="dropdown-item">Edit...</a></t>
									<t t-if="widget.deletable"><a role="menuitem" type="delete" class="dropdown-item">Delete</a></t>
								</div>
							</div>
							<div class="oe_kanban_content">
								<div class="o_kanban_record_top">
								    <b class="o_kanban_record_title"><field name="name"/></b>
								</div>
								<div class="o_kanban_record_body">
								    <div t-if="record.serial_code.raw_value"><field name="serial_code"/></div>
								    <div t-if="record.company_id.raw_value"><field name="company_id"/></div>
								</div>
							</div>
						</div>
					</t>
				</templates>
			</kanban>
		</field>
	</record>

	<record id="device_tree_view" model="ir.ui.view">
		<field name="name">device.tree.view</field>
		<field name="model">technical.service.device</field>
		<field name="arch" type="xml">
			<tree>
				<field name="name"/>
				<field name="company_id"/>
				<field name="serial_code"/>
				<field name="category_id"/>
			</tree>
		</field>
	</record>

	<record id="device_search_view" model="ir.ui.view">
		<field name="name">device.search.view</field>
		<field name="model">technical.service.device</field>
		<field name="arch" type="xml">
			<search>
				<field name="name"/>
				<field name="serial_code"/>
				<field name="company_id"/>
				<field name="category_id"/>
				<group string="Group By">
					<filter string="Company" name="groupby_company" domain="[]" context="{'group_by': 'company_id'}"/>
					<filter string="Category" name="groupby_category" domain="[]" context="{'group_by': 'category_id'}"/>
				</group>
			</search>
		</field>
	</record>

	<record id="devices_action" model="ir.actions.act_window">
		<field name="name">Devices</field>
		<field name="res_model">technical.service.device</field>
		<field name="view_mode">kanban,tree,form</field>
		<field name="help" type="html">
			<p class="o_view_nocontent_smiling_face">
				Add a new available device to your list
			</p>
		</field>
	</record>

	<record id="devices_category_form_view" model="ir.ui.view">
		<field name="name">devices.category.form.view</field>
		<field name="model">technical.service.device.category</field>
		<field name="arch" type="xml">
			<form string="Category">
				<sheet>
					<div class="oe_title">
					    <label for="name" class="oe_edit_only" string="Name"/>
					    <h1>
					        <field name="name" placeholder="Category Name"/>
					    </h1>
					</div>
					<h3><label for="description" string="Description"/></h3>
					<field name="description" placeholder="Your description here.."/>
				</sheet>
			</form>
		</field>
	</record>

	<record id="devices_category_tree_view" model="ir.ui.view">
		<field name="name">device.category.tree.view</field>
		<field name="model">technical.service.device.category</field>
		<field name="arch" type="xml">
			<tree editable="bottom" create="0">
				<field name="name"/>
				<field name="description"/>
			</tree>
		</field>
	</record>

	<record id="device_category_action" model="ir.actions.act_window">
		<field name="name">Device Categories</field>
		<field name="res_model">technical.service.device.category</field>
		<field name="view_type">form</field>
		<field name="view_mode">tree,form</field>
		<field name="view_id" ref="technical_service.devices_category_tree_view"/>
		<field name="help" type="html">
			<p class="o_view_nocontent_smiling_face">
				Add a new category for your Devices
			</p>
		</field>
	</record>
</odoo>