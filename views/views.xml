<?xml version="1.0" encoding="utf-8" ?>

<odoo>

	<record id="requests_kanban_view" model="ir.ui.view">
		<field name="name">requests.kaban.view</field>
		<field name="model">technical.service.request</field>
		<field name="inherit_id" ref="maintenance.hr_equipment_request_view_kanban"/>
		<field name="mode">primary</field>
		<field name="arch" type="xml">
			<xpath expr="//templates/t[@t-name='kanban-tooltip']" position="replace">
				<t t-name="kanban-tooltip">
					<p>Click here to see details</p>
				</t>
			</xpath>
			<field name="activity_state" position="after">
				<field name="related_company_id"/>
				<field name="technical_team"/>
				<field name="customer"/>
				<field name="address"/>
				<field name="device"/>
				<field name="custom_field1"/>
				<field name="custom_field2"/>
			</field>
			<xpath expr="//div[@class='o_kanban_record_top']/b" position="inside">
				<field name="related_company_id"/>
			</xpath>
			<xpath expr="//div[@class='o_kanban_record_body']/span[@class='oe_grey']" position="replace">
				<span class="oe_grey">
					<field name="equipment_id"/>
					<field name="technical_team"/>
					<br/>
				</span>
			</xpath>
		</field>
	</record>


	<record id="requests_form_view" model="ir.ui.view">
		<field name="name">requests.form.view</field>
		<field name="model">technical.service.request</field>
		<field name="arch" type="xml">
			<form string="Maintenance Request">
			    <header>
			        <button string="Cancel" name="archive_equipment_request" type="object" attrs="{'invisible': [('archive', '=', True)]}"/>
			        <button string="Reopen Request" name="reset_equipment_request" type="object" attrs="{'invisible': [('archive', '=', False)]}"/>
			        <field name="stage_id" widget="statusbar" options="{'clickable': '1'}" attrs="{'invisible': [('archive', '=', True)]}"/>
			    </header>
			    <sheet>
			    	<field name="equipment_id" invisible="1"/>
			    	<field name="maintenance_type" invisible="1"/>
			    	<field name="maintenance_team_id" invisible="1"/>
			    	<field name="company_id" groups="base.group_multi_company" options="{'no_create': True}" invisible="1"/>
			    	<field name="category_id" groups="maintenance.group_equipment_manager" invisible="1"/>
			    	<field name="maintenance_type" widget="radio" invisible="1"/>

			    	<div attrs="{'invisible': [('archive', '=', False)]}">
			    	    <span class="badge badge-warning float-right">Canceled</span>
			    	</div>
			    	<div class="oe_right">
			    	    <field name="kanban_state" class="oe_inline" widget="state_selection"/>
			    	</div>
			    	<div class="oe_title">
			    	    <label for="name" class="oe_edit_only" string="Name"/>
			    	    <h1>
			    	        <field name="name" placeholder="Maintenance Request"/>
			    	    </h1>
			    	</div>
			    	<group>
			    		<group>
			    			<field name="owner_user_id" string="Requested By"/>
			    			<field name="request_date" readonly="True"/>
			    		</group>
			    		<group>
			    			<field name="priority" widget="priority"/>
			    			<field name="archive" invisible="1"/>
			    		</group>
			    	</group>
			    	<group>
			    		<group>
			    			<separator string="Customer"/>
			    			<field name="our_companies" invisible="1"/>
			    			<field name="customer" domain="[('id','not in',our_companies)]"/>
			    			<field name="address"/>
			    			<field name="device"/>

			    			<br/><br/>
			    			<separator string="Operation"/>
			    			<field name="user_id" string="Responsible"/>
			    			<field name="technical_team"/>
			    			<field name="schedule_date"/>
                            <label for="duration"/>
                            <div>
                                <field name="duration"
                                       widget="float_time"
                                       class="oe_inline"/> <span class="ml8">hours</span>
                            </div>
                            <field name="close_date" groups="base.group_no_one" readonly="True"/>
                        </group>
                        <group>
                        	<separator string="Data by Company"/>
                        	<field name="related_company_id"/>
                        	<field name="custom_field1" attrs="{'invisible': [('related_company_id','not in', (19,))]}"/>
                        	<field name="custom_field2"/>
                        </group>
                    </group>
                    <field name='description' placeholder="Internal Note ......."/>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>


	<record id="requests_action" model="ir.actions.act_window">
		<field name="name">Technical Service Requests</field>
		<field name="res_model">technical.service.request</field>
	    <field name="view_mode">kanban,form</field>
	    <field name="view_id" ref="requests_kanban_view"/>
	    <field name="context">{'default_user_id': uid}</field>
	    <field name="help" type="html">
	        <p class="o_view_nocontent_smiling_face">
	            Add a new technical service request
	        </p>
	    </field>
	</record>

	<record id="teams_action" model="ir.actions.act_window">
		<field name="name">Teams</field>
		<field name="res_model">technical.service.team</field>
		<field name="view_mode">tree,form</field>
	</record>

	<!-- TODO - It'd be much better to write a kanban view for devices showing their photos -->

	<record id="devices_form_view" model="ir.ui.view">
		<field name="name">devices.form.view</field>
		<field name="model">technical.service.device</field>
		<field name="arch" type="xml">
			<form>
				<sheet>
					<field name="photo" widget='image' class="oe_avatar"/>
					<group>
						<group>
							<field name="name" />
							<field name="category_id"/>
						</group>
						<group>
							<field name="serial_code"/>
							<field name="company_id"/>
						</group>
					</group>
					<h3><label for="notes" string="Notes"/></h3>
					<field name="notes"/>
				</sheet>
			</form>
		</field>
	</record>

	<record id="devices_kanban_view" model="ir.ui.view">
		<field name="name">devices.kanban.view</field>
		<field name="model">technical.service.device</field>
		<field name="arch" type="xml">
			<kanban>
				<field name="id"/>
				<field name="image_medium"/>
				<field name="name"/>
				<field name="serial_code"/>
				<field name="company_id"/>
				<templates>
					<t t-name="kanban-box">
						<div t-attf-class="oe_kanban_card oe_kanban_global_click o_kanban_record_has_image_fill">
							<div class="o_kanban_image">
                               <img t-att-alt="record.name.value" t-att-src="kanban_image('technical.service.device', 'image_medium', record.id.raw_value)"/>
                           </div>
							<div class="o_dropdown_kanban dropdown">
								<a role="button" class="dropdown-toggle o-no-caret btn" data-toggle="dropdown" href="#" aria-label="Dropdown menu" title="Dropdown menu">
									<span class="fa fa-ellipsis-v"/>
								</a>
								<div class="dropdown-menu" role="menu">
									<t t-if="widget.editable"><a role="menuitem" type="edit" class="dropdown-item">Edit...</a></t>
									<t t-if="widget.deletable"><a role="menuitem" type="delete" class="dropdown-item">Delete</a></t>
								</div>
							</div>
							<div class="oe_kanban_content">
								<div class="o_kanban_record_top">
								    <b class="o_kanban_record_title"><field name="name"/></b>
								</div>
								<div class="o_kanban_record_body">
								    <div t-if="record.serial_code.raw_value"><field name="serial_code"/></div>
								    <div t-if="record.company_id.raw_value"><field name="company_id"/></div>
								</div>
							</div>
						</div>
					</t>
				</templates>
			</kanban>
		</field>
	</record>

	<record id="device_search_view" model="ir.ui.view">
		<field name="name">device.search.view</field>
		<field name="model">technical.service.device</field>
		<field name="arch" type="xml">
			<search>
				<field name="name"/>
				<field name="serial_code"/>
				<field name="company_id"/>
				<field name="category_id"/>
				<group string="Group By">
					<filter string="Company" name="groupby_company" domain="[]" context="{'group_by': 'company_id'}"/>
					<filter string="Category" name="groupby_category" domain="[]" context="{'group_by': 'category_id'}"/>
				</group>
			</search>
		</field>
	</record>

	<record id="devices_category_form_view" model="ir.ui.view">
		<field name="name">devices_category_form_view</field>
		<field name="model">technical.service.device.category</field>
		<field name="arch" type="xml">
			<form string="Category">
				<sheet>
					<div class="oe_title">
					    <label for="name" class="oe_edit_only" string="Name"/>
					    <h1>
					        <field name="name" placeholder="Category Name"/>
					    </h1>
					</div>
					<h3><label for="description" string="Description"/></h3>
					<field name="description" placeholder="Your description here.."/>
					<br/>
					<h3><label for="device_ids" string="Devices"/></h3>
					<field name="device_ids" />
				</sheet>
			</form>
		</field>
	</record>

	<record id="devices_action" model="ir.actions.act_window">
		<field name="name">Devices</field>
		<field name="res_model">technical.service.device</field>
		<field name="view_mode">kanban,tree,form</field>
		<field name="help" type="html">
			<p class="o_view_nocontent_smiling_face">
				Add a new available device to your list
			</p>
		</field>
	</record>



</odoo>